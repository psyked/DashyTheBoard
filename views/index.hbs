<input id="start-time" name="start-time" type="date">
<input id="end-time" name="end-time" type="date">
<button id="get-button">Get</button>
<hr>
<div id='chart'></div>
<!--<div id='loadchart'></div>-->
<script>
    var chart, chartData;

    document.getElementById('get-button').addEventListener('click', function() {
        d3.json('/traffic/' + document.getElementById('start-time').value + '/' + document.getElementById('end-time').value,
                function(error, data) {
                    if(error) {
                        return console.warn(error);
                    }
                    chart.load({
                        rows: chartData.concat(data.rows)
                    })
                })
    });

    d3.json('/traffic/2015-09-01/2015-09-30', function(error, data) {
        if(error) {
            return console.warn(error);
        }

        chartData = data.rows;
        //        data.rows.unshift(["date", "users", "pageviews"]);
        var headers = data.columnHeaders.map(function(val) {
            return val.name;//.split(":").join("_");
        });
        //        console.log(headers.slice());
        data.rows.unshift(headers.slice());
        var xAxis = headers.shift();
        //        console.log(xAxis, headers);
        var template = {
            bindto: '#chart',
            data: {
                rows: data.rows,
                x: xAxis,
                xFormat: '%Y%m%d',
                types: {
                    "ga:pageviews": 'area',
                    "ga:users": 'area'
                },
                keys: {
                    value: headers
                },
                //                groups: [
                //                    [
                //                        'users',
                //                        'pageviews'
                //                    ]
                //                ],
                axes: {
                    "ga:users": 'y',
                    "ga:pageviews": 'y2'
                }
            },
            axis: {
                x: {
                    label: {
                        text: 'Date',
                        position: 'outer-center'
                    },
                    type: 'timeseries',
                    tick: {
                        format: "%d-%m-%Y"
                    }
                },
                y: {
                    label: {
                        text: 'Users',
                        position: 'outer-middle'
                    }
                },
                y2: {
                    label: {
                        text: 'Page views',
                        position: 'outer-middle'
                    },
                    show: true
                }
            },
            grid: {
                //                x: {
                //                    show: true
                //                },
                y: {
                    show: true
                }
            }
        };

        chart = c3.generate(template);

        //        setTimeout(function() {
        //            d3.json('/traffic/2015-04-01/2015-06-01', function(error, data) {
        //                if(error) {
        //                    return console.warn(error);
        //                }
        //                chart.load({
        //                    rows: chartData.concat(data.rows)
        //                })
        //            })
        //        }, 1000);
    });

    //    d3.json('/load/2015-01-01/2015-03-01', function(error, data) {
    //        if(error) {
    //            return console.warn(error);
    //        }
    //
    //        data.rows.unshift(["date", "pageLoadTime", "pageDownloadTime", "domContentLoadedTime"]);
    //        var template = {
    //            bindto: '#loadchart',
    //            data: {
    //                rows: data.rows,
    //                x: 'date',
    //                xFormat: '%Y%m%d',
    //                type: 'area',
    //                groups: [
    //                    [
    //                        'pageLoadTime',
    //                        'pageDownloadTime',
    //                        'domContentLoadedTime'
    //                    ]
    //                ]
    //            },
    //            axis: {
    //                x: {
    //                    type: 'timeseries',
    //                    tick: {
    //                        format: "%d-%m-%Y"
    //                    }
    //                }
    //            }
    //        };
    //
    //        var chart = c3.generate(template);
    //    });
</script>